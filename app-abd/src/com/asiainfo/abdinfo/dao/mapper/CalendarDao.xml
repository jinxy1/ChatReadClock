<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.asiainfo.abdinfo.dao.CalendarDao">

    <resultMap type="com.asiainfo.abdinfo.po.Calendar" id="calendar">
       <id column="project" property="project"/>
       <result column="icon" property="icon"/>
      <collection property="contents" ofType="string"  javaType="ArrayList" column="project">
          <result column="content" />  
     </collection>
    </resultMap>
	
	<sql id="numberDate">
	   工号=#{staffCode} AND 日期=#{date}
	</sql>
	
	<sql id="numberDateNew">
	staffCode=#{staffCode} AND date=#{date}
	</sql>
	
	<!-- 日历模块 -->
	<select id="selectCalendarContent" resultMap="calendar">
	<!-- 	SELECT  '上班时间' AS project,concat('打卡时间：',substring(MIN(时间),1,5))  AS content,'sumRound' AS icon  
		from dakajilu WHERE <include refid="numberDate"/>
		union all
		SELECT  '下班时间' AS project,concat('打卡时间：',substring(MAX(时间),1,5))  AS content,'moonRound' AS icon  
		from dakajilu WHERE <include refid="numberDate"/>
		UNION ALL -->
		SELECT pROJECT,CONTENT,ICON FROM CALENDAR_PROJECT WHERE STAFF_CODE=#{staffCode} AND DATE=#{date}
		UNION ALL
		SELECT '【读书感悟】' as project,ReadingFeeling as content, 'book' as icon from reading_plancontent WHERE staffCode=#{staffCode} and ClockDate=#{date} AND ReadingFeeling!=''
		UNION ALL
		SELECT '【行之实践】' as project ,actconcom as content ,'conclusion' as icon FROM work_plan WHERE <include refid="numberDateNew"/>
		UNION ALL
	   <!--  SELECT '【精进】' as project,CONCAT("【",types,"】",content) AS  content,'practice' as icon FROM Reading_reflection WHERE staffCode='18060405' AND date='2019-02-14' AND  content!='' --> 
		SELECT '【精进】' as project,CONCAT("【",types,"】",char(10),content) AS  content,'practice' as icon FROM Reading_reflection WHERE <include refid="numberDateNew"/> AND  content!=''
		union ALL
		SELECT '【今日感恩】' as project ,oweDetails as content , 'gratitude' as icon FROM owes_content WHERE <include refid="numberDateNew"/>
		UNION ALL
		SELECT Customtype as project,Customcontent as content ,'career' as icon from custom_reflection WHERE <include refid="numberDateNew"/>
		
	</select>
	
	
	
	<!-- 将考勤模块单独拿出来 -->
	<select id="selectAttendance" resultType="String">
	 SELECT 时间  as content from dakajilu WHERE 工号=#{staffCode} AND 日期=#{date}
	</select>
	
	<!-- 判断指定日期是否有读书内容 -->
	<select id="judgeRead" resultType="String">
   	SELECT ReadingFeeling
    from reading_plancontent WHERE staffCode=#{staffCode} and ClockDate=#{date} 
	</select>
	
	

	

	
	
	
	
</mapper>


